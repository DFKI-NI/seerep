
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../projects/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.1, mkdocs-material-9.1.21">
    
    
      
        <title>Sending & Querying Images - SEEREP Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#sending-querying-images" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SEEREP Documentation" class="md-header__button md-logo" aria-label="SEEREP Documentation" data-md-component="logo">
      
  <img src="../../imgs/DFKI_logo_outline_w.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SEEREP Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sending & Querying Images
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/agri-gaia/seerep" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../home/" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../getting-started/client/pypi/" class="md-tabs__link">
        Getting started
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/packages/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../overview/" class="md-tabs__link md-tabs__link--active">
        Tutorials
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SEEREP Documentation" class="md-nav__button md-logo" aria-label="SEEREP Documentation" data-md-component="logo">
      
  <img src="../../imgs/DFKI_logo_outline_w.png" alt="logo">

    </a>
    SEEREP Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/agri-gaia/seerep" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../home/" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          Client
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Client
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/client/pypi/" class="md-nav__link">
        gRPC python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Server
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Server
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/server/configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/server/installationDev/" class="md-nav__link">
        Dev Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/server/kubernetes-deployment/" class="md-nav__link">
        Kubernetes Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/server/local-deployment/" class="md-nav__link">
        Local Deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/server/docs/" class="md-nav__link">
        Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/server/tests/" class="md-nav__link">
        Tests
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/packages/" class="md-nav__link">
        Package Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        gRPC Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../projects/" class="md-nav__link">
        Creating & retrieving projects
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Sending & Querying Images
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Sending & Querying Images
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sending-images" class="md-nav__link">
    Sending images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query-images" class="md-nav__link">
    Query images
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sending-images" class="md-nav__link">
    Sending images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query-images" class="md-nav__link">
    Query images
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="sending-querying-images">Sending &amp; Querying images</h1>
<h2 id="sending-images">Sending images</h2>
<p>In this example we want to send images with labeled bounding boxes as well as general labels to SEEREP.</p>
<p>In order to save images, we need to mandatorily provide the intrinsics of the camera used to capture them.
After the sucessful save of camera intrinsics, we need to provide the uuid of it along with the images.
SEEREP will ensure that the Camera Intinsics UUID provided with an image has a UUID stored against it.</p>
<p>Additionally we add some coordinate transformations at the end.</p>
<p>Source: <code>examples/python/gRPC/images/gRPC_pb_sendLabeledImage.py</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="ch">#!/usr/bin/env python3</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">sys</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">import</span> <span class="nn">uuid</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="kn">from</span> <span class="nn">google.protobuf</span> <span class="kn">import</span> <span class="n">empty_pb2</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">boundingbox2d_labeled_pb2</span> <span class="k">as</span> <span class="n">boundingbox2d_labeled</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">boundingbox2d_labeled_with_category_pb2</span> <span class="k">as</span> <span class="n">boundingbox2d_labeled_with_category</span><span class="p">,</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="p">)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">camera_intrinsics_pb2</span> <span class="k">as</span> <span class="n">cameraintrinsics</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">camera_intrinsics_service_pb2_grpc</span> <span class="k">as</span> <span class="n">camintrinsics_service</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">image_pb2</span> <span class="k">as</span> <span class="n">image</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">image_service_pb2_grpc</span> <span class="k">as</span> <span class="n">imageService</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">label_with_instance_pb2</span> <span class="k">as</span> <span class="n">labelWithInstance</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="p">(</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="n">labels_with_instance_with_category_pb2</span> <span class="k">as</span> <span class="n">labels_with_instance_with_category</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="p">)</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">meta_operations_pb2_grpc</span> <span class="k">as</span> <span class="n">metaOperations</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">projectCreation_pb2</span> <span class="k">as</span> <span class="n">projectCreation</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">tf_service_pb2_grpc</span> <span class="k">as</span> <span class="n">tfService</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="kn">from</span> <span class="nn">seerep.pb</span> <span class="kn">import</span> <span class="n">transform_stamped_pb2</span> <span class="k">as</span> <span class="n">tf</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="kn">from</span> <span class="nn">seerep.util.common</span> <span class="kn">import</span> <span class="n">get_gRPC_channel</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="c1"># Default server is localhost !</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="n">channel</span> <span class="o">=</span> <span class="n">get_gRPC_channel</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="c1"># 1. Get gRPC service objects</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="n">stub</span> <span class="o">=</span> <span class="n">imageService</span><span class="o">.</span><span class="n">ImageServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="n">stubTf</span> <span class="o">=</span> <span class="n">tfService</span><span class="o">.</span><span class="n">TfServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="n">stubMeta</span> <span class="o">=</span> <span class="n">metaOperations</span><span class="o">.</span><span class="n">MetaOperationsStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="n">stubCI</span> <span class="o">=</span> <span class="n">camintrinsics_service</span><span class="o">.</span><span class="n">CameraIntrinsicsServiceStub</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="c1"># 2. Get all projects from the server</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="n">response</span> <span class="o">=</span> <span class="n">stubMeta</span><span class="o">.</span><span class="n">GetProjects</span><span class="p">(</span><span class="n">empty_pb2</span><span class="o">.</span><span class="n">Empty</span><span class="p">())</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a><span class="c1"># 3. Check if we have an existing test project, if not, one is created.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">projects</span><span class="p">:</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">project</span><span class="o">.</span><span class="n">uuid</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>    <span class="k">if</span> <span class="n">project</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;testproject&quot;</span><span class="p">:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>        <span class="n">projectuuid</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="n">uuid</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>    <span class="n">creation</span> <span class="o">=</span> <span class="n">projectCreation</span><span class="o">.</span><span class="n">ProjectCreation</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testproject&quot;</span><span class="p">,</span> <span class="n">mapFrameId</span><span class="o">=</span><span class="s2">&quot;map&quot;</span><span class="p">)</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>    <span class="n">projectCreated</span> <span class="o">=</span> <span class="n">stubMeta</span><span class="o">.</span><span class="n">CreateProject</span><span class="p">(</span><span class="n">creation</span><span class="p">)</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>    <span class="n">projectuuid</span> <span class="o">=</span> <span class="n">projectCreated</span><span class="o">.</span><span class="n">uuid</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="n">theTime</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="c1">#####</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="c1"># A valid camera intrinsics UUID is needed here for succesful storage of Images</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="c1"># Add new Camera Intrinsics</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="n">ciuuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Camera Intrinsics will be saved against the uuid: &quot;</span><span class="p">,</span> <span class="n">ciuuid</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="n">camin</span> <span class="o">=</span> <span class="n">cameraintrinsics</span><span class="o">.</span><span class="n">CameraIntrinsics</span><span class="p">()</span>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="n">camin</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="n">camin</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span><span class="o">.</span><span class="n">nanos</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a><span class="n">camin</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s2">&quot;camintrinsics&quot;</span>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="n">camin</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">uuid_project</span> <span class="o">=</span> <span class="n">projectuuid</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="n">camin</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">uuid_msgs</span> <span class="o">=</span> <span class="n">ciuuid</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="n">camin</span><span class="o">.</span><span class="n">region_of_interest</span><span class="o">.</span><span class="n">x_offset</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="n">camin</span><span class="o">.</span><span class="n">region_of_interest</span><span class="o">.</span><span class="n">y_offset</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="n">camin</span><span class="o">.</span><span class="n">region_of_interest</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="n">camin</span><span class="o">.</span><span class="n">region_of_interest</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="n">camin</span><span class="o">.</span><span class="n">region_of_interest</span><span class="o">.</span><span class="n">do_rectify</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="n">camin</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="n">camin</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">4</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="n">camin</span><span class="o">.</span><span class="n">distortion_model</span> <span class="o">=</span> <span class="s2">&quot;plump_bob&quot;</span>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="n">camin</span><span class="o">.</span><span class="n">distortion</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="n">camin</span><span class="o">.</span><span class="n">intrinsic_matrix</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="n">camin</span><span class="o">.</span><span class="n">rectification_matrix</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="n">camin</span><span class="o">.</span><span class="n">projection_matrix</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a><span class="n">camin</span><span class="o">.</span><span class="n">binning_x</span> <span class="o">=</span> <span class="mi">6</span>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="n">camin</span><span class="o">.</span><span class="n">binning_y</span> <span class="o">=</span> <span class="mi">7</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="n">stubCI</span><span class="o">.</span><span class="n">TransferCameraIntrinsics</span><span class="p">(</span><span class="n">camin</span><span class="p">)</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="c1"># 4. Create ten images</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a>    <span class="n">theImage</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">Image</span><span class="p">()</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a>    <span class="n">rgb</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a>    <span class="n">lim</span> <span class="o">=</span> <span class="mi">256</span>  <span class="c1"># 256 x 256 pixels</span>
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="p">):</span>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lim</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a>            <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">/</span> <span class="n">lim</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a>            <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="n">lim</span>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a>            <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="n">lim</span>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a>            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ubyte</span><span class="p">((</span><span class="n">x</span> <span class="o">*</span> <span class="mf">255.0</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">255</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a>            <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ubyte</span><span class="p">((</span><span class="n">y</span> <span class="o">*</span> <span class="mf">255.0</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">255</span><span class="p">)</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a>            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ubyte</span><span class="p">((</span><span class="n">z</span> <span class="o">*</span> <span class="mf">255.0</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">255</span><span class="p">)</span>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a>            <span class="n">rgb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a>            <span class="n">rgb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a>            <span class="n">rgb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a>    <span class="c1"># Add image meta-data</span>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s2">&quot;camera&quot;</span>
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">theTime</span> <span class="o">+</span> <span class="n">n</span>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span><span class="o">.</span><span class="n">nanos</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">uuid_project</span> <span class="o">=</span> <span class="n">projectuuid</span>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">lim</span>
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">lim</span>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s2">&quot;rgb8&quot;</span>
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">lim</span>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">uuid_camera_intrinsics</span> <span class="o">=</span> <span class="n">ciuuid</span>
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a>    <span class="c1"># Add image data</span>
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a>    <span class="n">theImage</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">rgb</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a>    <span class="k">for</span> <span class="n">iCategory</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a>        <span class="n">bbCat</span> <span class="o">=</span> <span class="n">boundingbox2d_labeled_with_category</span><span class="o">.</span><span class="n">BoundingBox2DLabeledWithCategory</span><span class="p">()</span>
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a>        <span class="n">bbCat</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">iCategory</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a>        <span class="c1"># 5. Create bounding boxes with labels</span>
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a>        <span class="n">bb</span> <span class="o">=</span> <span class="n">boundingbox2d_labeled</span><span class="o">.</span><span class="n">BoundingBox2DLabeled</span><span class="p">()</span>
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a>            <span class="n">bb</span><span class="o">.</span><span class="n">labelWithInstance</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;testlabel&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a>            <span class="n">bb</span><span class="o">.</span><span class="n">labelWithInstance</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="mf">10.0</span>
<a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a>            <span class="n">bb</span><span class="o">.</span><span class="n">labelWithInstance</span><span class="o">.</span><span class="n">instanceUuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
<a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a>            <span class="n">bb</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">center_point</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">+</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">10</span>
<a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a>            <span class="n">bb</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">center_point</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="o">+</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">10</span>
<a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a>            <span class="n">bb</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">spatial_extent</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.03</span> <span class="o">+</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">10</span>
<a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a>            <span class="n">bb</span><span class="o">.</span><span class="n">boundingBox</span><span class="o">.</span><span class="n">spatial_extent</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.04</span> <span class="o">+</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">10</span>
<a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a>            <span class="n">bbCat</span><span class="o">.</span><span class="n">boundingBox2DLabeled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bb</span><span class="p">)</span>
<a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a>        <span class="n">theImage</span><span class="o">.</span><span class="n">labels_bb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbCat</span><span class="p">)</span>
<a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a>        <span class="c1"># # 6. Add general labels to the image</span>
<a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a>        <span class="n">labelsCat</span> <span class="o">=</span> <span class="n">labels_with_instance_with_category</span><span class="o">.</span><span class="n">LabelsWithInstanceWithCategory</span><span class="p">()</span>
<a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a>        <span class="n">labelsCat</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">iCategory</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">labelWithInstance</span><span class="o">.</span><span class="n">LabelWithInstance</span><span class="p">()</span>
<a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a>            <span class="n">label</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;testlabelgeneral&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a>            <span class="n">label</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="mf">10.0</span>
<a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a>            <span class="c1"># assuming that that the general labels are not instance related -&gt; no instance uuid</span>
<a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a>            <span class="c1"># label.instanceUuid = str(uuid.uuid4())</span>
<a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a>            <span class="n">labelsCat</span><span class="o">.</span><span class="n">labelWithInstance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152" href="#__codelineno-0-152"></a>        <span class="n">theImage</span><span class="o">.</span><span class="n">labels_general</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labelsCat</span><span class="p">)</span>
<a id="__codelineno-0-153" name="__codelineno-0-153" href="#__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154" href="#__codelineno-0-154"></a>    <span class="c1"># 7. Send image to the server</span>
<a id="__codelineno-0-155" name="__codelineno-0-155" href="#__codelineno-0-155"></a>    <span class="n">uuidImg</span> <span class="o">=</span> <span class="n">stub</span><span class="o">.</span><span class="n">TransferImage</span><span class="p">(</span><span class="n">theImage</span><span class="p">)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156" href="#__codelineno-0-156"></a>
<a id="__codelineno-0-157" name="__codelineno-0-157" href="#__codelineno-0-157"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;uuid of transfered img: &quot;</span> <span class="o">+</span> <span class="n">uuidImg</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158" href="#__codelineno-0-158"></a>
<a id="__codelineno-0-159" name="__codelineno-0-159" href="#__codelineno-0-159"></a><span class="c1"># 8. Add coordinate transformations and send them to the server</span>
<a id="__codelineno-0-160" name="__codelineno-0-160" href="#__codelineno-0-160"></a><span class="n">theTf</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">TransformStamped</span><span class="p">()</span>
<a id="__codelineno-0-161" name="__codelineno-0-161" href="#__codelineno-0-161"></a><span class="n">theTf</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">frame_id</span> <span class="o">=</span> <span class="s2">&quot;map&quot;</span>
<a id="__codelineno-0-162" name="__codelineno-0-162" href="#__codelineno-0-162"></a><span class="n">theTf</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">theTime</span>
<a id="__codelineno-0-163" name="__codelineno-0-163" href="#__codelineno-0-163"></a><span class="n">theTf</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">uuid_project</span> <span class="o">=</span> <span class="n">projectuuid</span>
<a id="__codelineno-0-164" name="__codelineno-0-164" href="#__codelineno-0-164"></a><span class="n">theTf</span><span class="o">.</span><span class="n">child_frame_id</span> <span class="o">=</span> <span class="s2">&quot;camera&quot;</span>
<a id="__codelineno-0-165" name="__codelineno-0-165" href="#__codelineno-0-165"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-166" name="__codelineno-0-166" href="#__codelineno-0-166"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-167" name="__codelineno-0-167" href="#__codelineno-0-167"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-0-168" name="__codelineno-0-168" href="#__codelineno-0-168"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-169" name="__codelineno-0-169" href="#__codelineno-0-169"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-170" name="__codelineno-0-170" href="#__codelineno-0-170"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-171" name="__codelineno-0-171" href="#__codelineno-0-171"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">rotation</span><span class="o">.</span><span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-172" name="__codelineno-0-172" href="#__codelineno-0-172"></a><span class="n">stubTf</span><span class="o">.</span><span class="n">TransferTransformStamped</span><span class="p">(</span><span class="n">theTf</span><span class="p">)</span>
<a id="__codelineno-0-173" name="__codelineno-0-173" href="#__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174" href="#__codelineno-0-174"></a><span class="n">theTf</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">stamp</span><span class="o">.</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">theTime</span> <span class="o">+</span> <span class="mi">10</span>
<a id="__codelineno-0-175" name="__codelineno-0-175" href="#__codelineno-0-175"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-0-176" name="__codelineno-0-176" href="#__codelineno-0-176"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">200</span>
<a id="__codelineno-0-177" name="__codelineno-0-177" href="#__codelineno-0-177"></a><span class="n">theTf</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">translation</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="mi">300</span>
<a id="__codelineno-0-178" name="__codelineno-0-178" href="#__codelineno-0-178"></a><span class="n">stubTf</span><span class="o">.</span><span class="n">TransferTransformStamped</span><span class="p">(</span><span class="n">theTf</span><span class="p">)</span>
</code></pre></div>
<p>Output:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>5836f989-adbb-46a0-a689-9e0527d457fe
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>5b39487d-238a-43e4-a8a4-0f7efb876e8b
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>00ced216-40b1-4d54-817f-11c413b228c6
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>5d330208-e534-4bfb-b242-00295e6b027d
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>18f00f33-0ac5-4221-a428-13e2c37b27cd
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>ed5134c8-da18-476f-9c1b-60cea04c5627
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>22c995b0-c2b6-4c94-85a3-b1118ae3ac7d
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>9d980608-85ff-4e62-a6be-01c05bd59de9
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>24204e3f-1cbd-4cab-99b6-803b3944b450
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>uuid<span class="w"> </span>of<span class="w"> </span>transfered<span class="w"> </span>img:<span class="w"> </span>797f2e1a-f9e8-4ed3-94b3-a5d101aa0697
</code></pre></div>
<h2 id="query-images">Query images</h2>
<p>Now we want to query the previously send images with some criteria. Possible query parameters are:</p>
<ul>
<li>2D Polygon (spatial query)</li>
</ul>
<p>Spatial queries in SEEREP are performed using a 2D polygon. This polygon should be simple (no more than 2
vertices on the same edge) and convex (no edges curving inward). This 2D polygon has a location on the z axis,
and a height. Queries are performed by forming an encompassing axis aligned bounding box out of the polygon.
This can lead to an AABB larger than the polygon. This poses the potential problem of returning results to the
user which are not fully inside the polygon from the query. But it is inside the AABB derived from it for the
purpose of performing the query. This problem is resolved by providing a boolean variable called
fullyEncapsulated`. If false, resultant polygons, which are partially inside the query polygon are also returned.</p>
<ul>
<li>
<p>A time interval (temporal query)</p>
</li>
<li>
<p>Labels (semantic query)</p>
</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Protocol Buffers</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Source: <code>examples/python/gRPC/images/gRPC_pb_queryImage.py</code></p>
<p>```python</p>
</div>
</div>
</div>
<p>#!/usr/bin/env python3</p>
<div class="highlight"><pre><span></span><code>import sys

from google.protobuf import empty_pb2
from seerep.pb import image_service_pb2_grpc as imageService
from seerep.pb import label_pb2
from seerep.pb import labels_with_category_pb2 as labels_with_category
from seerep.pb import meta_operations_pb2_grpc as metaOperations
from seerep.pb import query_pb2 as query
from seerep.pb import point2d_pb2 as point2d
from seerep.util.common import get_gRPC_channel

# Default server is localhost !
channel = get_gRPC_channel()

# 1. Get gRPC service objects
stub = imageService.ImageServiceStub(channel)
stubMeta = metaOperations.MetaOperationsStub(channel)

# 2. Get all projects from the server
response = stubMeta.GetProjects(empty_pb2.Empty())

# 3. Check if we have an existing test project, if not, we stop here
projectuuid = &quot;&quot;
for project in response.projects:
    print(project.name + &quot; &quot; + project.uuid + &quot;\n&quot;)
    if project.name == &quot;testproject&quot;:
        projectuuid = project.uuid

if projectuuid == &quot;&quot;:
    sys.exit()

# 4. Create a query with parameters
theQuery = query.Query()
theQuery.projectuuid.append(projectuuid)

theQuery.polygon.z = -1
theQuery.polygon.height = 7

l = 100
bottom_left = point2d.Point2D()
bottom_left.x = -l
bottom_left.y = -l
theQuery.polygon.vertices.append(bottom_left)

top_left = point2d.Point2D()
top_left.x = -l
top_left.y = l
theQuery.polygon.vertices.append(top_left)

top_right = point2d.Point2D()
top_right.x = l
top_right.y = l
theQuery.polygon.vertices.append(top_right)

bottom_right = point2d.Point2D()
bottom_right.x = l
bottom_right.y = -l
theQuery.polygon.vertices.append(bottom_right)

# since epoche
theQuery.timeinterval.time_min.seconds = 1638549273
theQuery.timeinterval.time_min.nanos = 0
theQuery.timeinterval.time_max.seconds = 1938549273
theQuery.timeinterval.time_max.nanos = 0

# labels
label = labels_with_category.LabelsWithCategory()
label.category = &quot;0&quot;
labelWithConfidence = label_pb2.Label()
labelWithConfidence.label = &quot;testlabel0&quot;
label.labels.extend([labelWithConfidence])
theQuery.labelsWithCategory.append(label)

# 5. Query the server for images matching the query and iterate over them
for img in stub.GetImage(theQuery):
    print(
        f&quot;uuidmsg: {img.header.uuid_msgs}&quot;
        + &quot;\n&quot;
        + f&quot;first label: {img.labels_bb[0].boundingBox2DLabeled[0].labelWithInstance.label.label}&quot;
        + &quot;\n&quot;
        + f&quot;first label confidence: {img.labels_bb[0].boundingBox2DLabeled[0].labelWithInstance.label.confidence}&quot;
        + &quot;\n&quot;
        + &quot;First bounding box (Xcenter,Ycenter,Xextent,Yextent):&quot;
        + &quot; &quot;
        + str(img.labels_bb[0].boundingBox2DLabeled[0].boundingBox.center_point.x)
        + &quot; &quot;
        + str(img.labels_bb[0].boundingBox2DLabeled[0].boundingBox.center_point.y)
        + &quot; &quot;
        + str(img.labels_bb[0].boundingBox2DLabeled[0].boundingBox.spatial_extent.x)
        + &quot; &quot;
        + str(img.labels_bb[0].boundingBox2DLabeled[0].boundingBox.spatial_extent.y)
        + &quot;\n&quot;
    )
```

Output:

```
testproject 3af70ba8-1e81-4f60-86d2-a4257d88f01e

first label: testlabel0
First bounding box (Xmin, Ymin, Xmax, Ymax): 0.01 0.02 0.03 0.04

first label: testlabel0
First bounding box (Xmin, Ymin, Xmax, Ymax): 0.01 0.02 0.03 0.04

first label: testlabel0
First bounding box (Xmin, Ymin, Xmax, Ymax): 0.01 0.02 0.03 0.04

first label: testlabel0
First bounding box (Xmin, Ymin, Xmax, Ymax): 0.01 0.02 0.03 0.04
```
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Flatbuffers</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Source: <code>examples/images/gRPC/images/gRPC_fb_queryImage.py</code></p>
<p>```python</p>
<h1 id="usrbinenv-python3">!/usr/bin/env python3</h1>
<p>import flatbuffers
from seerep.fb import Image
from seerep.fb import image_service_grpc_fb as imageService
from seerep.util.common import get_gRPC_channel
from seerep.util.fb_helper import (
    createLabelWithCategory,
    createLabelWithConfidence,
    createPoint2d,
    createPolygon2D,
    createQuery,
    createTimeInterval,
    createTimeStamp,
    getProject,
)</p>
<p>builder = flatbuffers.Builder(1024)</p>
<h1 id="default-server-is-localhost">Default server is localhost !</h1>
<p>channel = get_gRPC_channel()</p>
<h1 id="1-get-all-projects-from-the-server">1. Get all projects from the server</h1>
<p>projectuuid = getProject(builder, channel, 'testproject')</p>
<h1 id="2-check-if-the-defined-project-exist-if-not-exit">2. Check if the defined project exist; if not exit</h1>
<p>if not projectuuid:
    print("project doesn't exist!")
    exit()</p>
<h1 id="3-get-grpc-service-object">3. Get gRPC service object</h1>
<p>stub = imageService.ImageServiceStub(channel)</p>
<h1 id="create-all-necessary-objects-for-the-query">Create all necessary objects for the query</h1>
<p>l = 100
polygon_vertices = []
polygon_vertices.append(createPoint2d(builder, -1.0 * l, -1.0 * l))
polygon_vertices.append(createPoint2d(builder, -1.0 * l, l))
polygon_vertices.append(createPoint2d(builder, l, l))
polygon_vertices.append(createPoint2d(builder, l, -1.0 * l))
polygon2d = createPolygon2D(builder, 7, -1, polygon_vertices)</p>
<p>timeMin = createTimeStamp(builder, 1610549273, 0)
timeMax = createTimeStamp(builder, 1938549273, 0)
timeInterval = createTimeInterval(builder, timeMin, timeMax)</p>
<p>projectUuids = [builder.CreateString(projectuuid)]</p>
<h1 id="list-of-categories">list of categories</h1>
<p>category = ["0"]</p>
<h1 id="list-of-labels-per-category">list of labels per category</h1>
<p>labels = [
    [
        createLabelWithConfidence(builder, "testlabel0"),
        createLabelWithConfidence(builder, "testlabelgeneral0"),
    ]
]
labelCategory = createLabelWithCategory(builder, category, labels)
dataUuids = [builder.CreateString("3e12e18d-2d53-40bc-a8af-c5cca3c3b248")]
instanceUuids = [builder.CreateString("3e12e18d-2d53-40bc-a8af-c5cca3c3b248")]</p>
<h1 id="4-create-a-query-with-parameters">4. Create a query with parameters</h1>
<h1 id="all-parameters-are-optional">all parameters are optional</h1>
<h1 id="with-all-parameters-set-especially-with-the-data-and-instance-uuids-set-the-result-of-the-query-will-be-empty-set-the-query-parameters-to-adequate-values-or-remove-them-from-the-query-creation">with all parameters set (especially with the data and instance uuids set) the result of the query will be empty. Set the query parameters to adequate values or remove them from the query creation</h1>
<p>query = createQuery(
    builder,
    # boundingBox=boundingboxStamped,
    # timeInterval=timeInterval,
    # labels=labelCategory,
    # mustHaveAllLabels=True,
    projectUuids=projectUuids,
    # instanceUuids=instanceUuids,
    # dataUuids=dataUuids,
    withoutData=True,
    fullyEncapsulated=False
)
builder.Finish(query)
buf = builder.Output()</p>
<h1 id="5-query-the-server-for-images-matching-the-query-and-iterate-over-them">5. Query the server for images matching the query and iterate over them</h1>
<p>for responseBuf in stub.GetImage(bytes(buf)):
    response = Image.Image.GetRootAs(responseBuf)</p>
<div class="highlight"><pre><span></span><code>print(f&quot;uuidmsg: {response.Header().UuidMsgs().decode(&#39;utf-8&#39;)}&quot;)
print(response.LabelsBbLength())
if response.LabelsBbLength() &gt; 0:
    print(
        &quot;first label: &quot;
        + response.LabelsBb(0).BoundingBox2dLabeled(0).LabelWithInstance().Label().Label().decode(&quot;utf-8&quot;)
        + &quot; ; confidence: &quot;
        + str(response.LabelsBb(0).BoundingBox2dLabeled(0).LabelWithInstance().Label().Confidence())
    )
    print(
        &quot;first bounding box (Xcenter,Ycenter,Xextent,Yextent, rotation): &quot;
        + str(response.LabelsBb(0).BoundingBox2dLabeled(0).BoundingBox().CenterPoint().X())
        + &quot; &quot;
        + str(response.LabelsBb(0).BoundingBox2dLabeled(0).BoundingBox().CenterPoint().Y())
        + &quot; &quot;
        + str(response.LabelsBb(0).BoundingBox2dLabeled(0).BoundingBox().SpatialExtent().X())
        + &quot; &quot;
        + str(response.LabelsBb(0).BoundingBox2dLabeled(0).BoundingBox().SpatialExtent().Y())
        + &quot; &quot;
        + str(response.LabelsBb(0).BoundingBox2dLabeled(0).BoundingBox().Rotation())
        + &quot;\n&quot;
    )
</code></pre></div>
<p>print("done.")</p>
</div>
</div>
</div>
<p>```</p>
<div class="highlight"><pre><span></span><code>Output:

```
testproject 3af70ba8-1e81-4f60-86d2-a4257d88f01e

uuidmsg: 00ced216-40b1-4d54-817f-11c413b228c6
first label: testlabel0
first bounding box (Xmin,Ymin,Xmax,Ymax): 0.01 0.02 0.03 0.04

uuidmsg: 5836f989-adbb-46a0-a689-9e0527d457fe
first label: testlabel0
first bounding box (Xmin,Ymin,Xmax,Ymax): 0.01 0.02 0.03 0.04

uuidmsg: 5b39487d-238a-43e4-a8a4-0f7efb876e8b
first label: testlabel0
first bounding box (Xmin,Ymin,Xmax,Ymax): 0.01 0.02 0.03 0.04

uuidmsg: 5d330208-e534-4bfb-b242-00295e6b027d
first label: testlabel0
first bounding box (Xmin,Ymin,Xmax,Ymax): 0.01 0.02 0.03 0.04

done.
```
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="/seerep/mkdocs/legal-notice/index.html">Legal Notice</a> - <a href="/seerep/mkdocs/data-protection-notice/index.html">Data Protection Notice</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tracking", "navigation.tabs", "navigation.expand", "navigation.sections"], "search": "../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
    
  </body>
</html>